'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.toPng = exports.toImageData = exports.toRgba = undefined;

var _pngjs = require('pngjs');

var _pngjs2 = _interopRequireDefault(_pngjs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var PNG = _pngjs2.default.PNG;

function imageDataToPng(imageData) {
  var width = imageData.width;
  var height = imageData.height;
  var pixels = imageData.data;
  var png = new PNG({ width: width, height: height });
  for (var i = 0; i < pixels.length; i += 1) {
    png.data[i] = pixels[i];
  }
  return PNG.sync.write(png);
}

function toRgba(gl, width, height) {
  var data = null;
  return function () {
    if (!data) {
      data = new Uint8Array(4 * width * height);
    }
    gl.readPixels(0, 0, width, height, gl.RGBA, gl.UNSIGNED_BYTE, data);
    return data;
  };
}

function toImageData(gl, width, height) {
  var data = toRgba(gl, width, height);
  return {
    data: data,
    width: width,
    height: height
  };
}

function toPng(gl, width, height) {
  return imageDataToPng(toImageData(gl, width, height));
}

exports.toRgba = toRgba;
exports.toImageData = toImageData;
exports.toPng = toPng;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9nbC10by5qcyJdLCJuYW1lcyI6WyJQTkciLCJpbWFnZURhdGFUb1BuZyIsImltYWdlRGF0YSIsIndpZHRoIiwiaGVpZ2h0IiwicGl4ZWxzIiwiZGF0YSIsInBuZyIsImkiLCJsZW5ndGgiLCJzeW5jIiwid3JpdGUiLCJ0b1JnYmEiLCJnbCIsIlVpbnQ4QXJyYXkiLCJyZWFkUGl4ZWxzIiwiUkdCQSIsIlVOU0lHTkVEX0JZVEUiLCJ0b0ltYWdlRGF0YSIsInRvUG5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7OztBQUNBLElBQU1BLE1BQU0sZ0JBQU1BLEdBQWxCOztBQUVBLFNBQVNDLGNBQVQsQ0FBeUJDLFNBQXpCLEVBQW9DO0FBQ2xDLE1BQU1DLFFBQVFELFVBQVVDLEtBQXhCO0FBQ0EsTUFBTUMsU0FBU0YsVUFBVUUsTUFBekI7QUFDQSxNQUFNQyxTQUFTSCxVQUFVSSxJQUF6QjtBQUNBLE1BQU1DLE1BQU0sSUFBSVAsR0FBSixDQUFRLEVBQUVHLFlBQUYsRUFBU0MsY0FBVCxFQUFSLENBQVo7QUFDQSxPQUFLLElBQUlJLElBQUksQ0FBYixFQUFnQkEsSUFBSUgsT0FBT0ksTUFBM0IsRUFBbUNELEtBQUssQ0FBeEMsRUFBMkM7QUFDekNELFFBQUlELElBQUosQ0FBU0UsQ0FBVCxJQUFjSCxPQUFPRyxDQUFQLENBQWQ7QUFDRDtBQUNELFNBQU9SLElBQUlVLElBQUosQ0FBU0MsS0FBVCxDQUFlSixHQUFmLENBQVA7QUFDRDs7QUFFRCxTQUFTSyxNQUFULENBQWlCQyxFQUFqQixFQUFxQlYsS0FBckIsRUFBNEJDLE1BQTVCLEVBQW9DO0FBQ2xDLE1BQUlFLE9BQU8sSUFBWDtBQUNBLFNBQU8sWUFBWTtBQUNqQixRQUFJLENBQUNBLElBQUwsRUFBVztBQUNUQSxhQUFPLElBQUlRLFVBQUosQ0FBZSxJQUFJWCxLQUFKLEdBQVlDLE1BQTNCLENBQVA7QUFDRDtBQUNEUyxPQUFHRSxVQUFILENBQWMsQ0FBZCxFQUFpQixDQUFqQixFQUFvQlosS0FBcEIsRUFBMkJDLE1BQTNCLEVBQW1DUyxHQUFHRyxJQUF0QyxFQUE0Q0gsR0FBR0ksYUFBL0MsRUFBOERYLElBQTlEO0FBQ0EsV0FBT0EsSUFBUDtBQUNELEdBTkQ7QUFPRDs7QUFFRCxTQUFTWSxXQUFULENBQXNCTCxFQUF0QixFQUEwQlYsS0FBMUIsRUFBaUNDLE1BQWpDLEVBQXlDO0FBQ3ZDLE1BQU1FLE9BQU9NLE9BQU9DLEVBQVAsRUFBV1YsS0FBWCxFQUFrQkMsTUFBbEIsQ0FBYjtBQUNBLFNBQU87QUFDTEUsVUFBTUEsSUFERDtBQUVMSCxXQUFPQSxLQUZGO0FBR0xDLFlBQVFBO0FBSEgsR0FBUDtBQUtEOztBQUVELFNBQVNlLEtBQVQsQ0FBZ0JOLEVBQWhCLEVBQW9CVixLQUFwQixFQUEyQkMsTUFBM0IsRUFBbUM7QUFDakMsU0FBT0gsZUFBZWlCLFlBQVlMLEVBQVosRUFBZ0JWLEtBQWhCLEVBQXVCQyxNQUF2QixDQUFmLENBQVA7QUFDRDs7UUFHQ1EsTSxHQUFBQSxNO1FBQ0FNLFcsR0FBQUEsVztRQUNBQyxLLEdBQUFBLEsiLCJmaWxlIjoiZ2wtdG8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcG5nanMgZnJvbSAncG5nanMnXG5jb25zdCBQTkcgPSBwbmdqcy5QTkdcblxuZnVuY3Rpb24gaW1hZ2VEYXRhVG9QbmcgKGltYWdlRGF0YSkge1xuICBjb25zdCB3aWR0aCA9IGltYWdlRGF0YS53aWR0aFxuICBjb25zdCBoZWlnaHQgPSBpbWFnZURhdGEuaGVpZ2h0XG4gIGNvbnN0IHBpeGVscyA9IGltYWdlRGF0YS5kYXRhXG4gIGNvbnN0IHBuZyA9IG5ldyBQTkcoeyB3aWR0aCwgaGVpZ2h0IH0pXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGl4ZWxzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgcG5nLmRhdGFbaV0gPSBwaXhlbHNbaV1cbiAgfVxuICByZXR1cm4gUE5HLnN5bmMud3JpdGUocG5nKVxufVxuXG5mdW5jdGlvbiB0b1JnYmEgKGdsLCB3aWR0aCwgaGVpZ2h0KSB7XG4gIHZhciBkYXRhID0gbnVsbFxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGlmICghZGF0YSkge1xuICAgICAgZGF0YSA9IG5ldyBVaW50OEFycmF5KDQgKiB3aWR0aCAqIGhlaWdodClcbiAgICB9XG4gICAgZ2wucmVhZFBpeGVscygwLCAwLCB3aWR0aCwgaGVpZ2h0LCBnbC5SR0JBLCBnbC5VTlNJR05FRF9CWVRFLCBkYXRhKVxuICAgIHJldHVybiBkYXRhXG4gIH1cbn1cblxuZnVuY3Rpb24gdG9JbWFnZURhdGEgKGdsLCB3aWR0aCwgaGVpZ2h0KSB7XG4gIGNvbnN0IGRhdGEgPSB0b1JnYmEoZ2wsIHdpZHRoLCBoZWlnaHQpXG4gIHJldHVybiB7XG4gICAgZGF0YTogZGF0YSxcbiAgICB3aWR0aDogd2lkdGgsXG4gICAgaGVpZ2h0OiBoZWlnaHRcbiAgfVxufVxuXG5mdW5jdGlvbiB0b1BuZyAoZ2wsIHdpZHRoLCBoZWlnaHQpIHtcbiAgcmV0dXJuIGltYWdlRGF0YVRvUG5nKHRvSW1hZ2VEYXRhKGdsLCB3aWR0aCwgaGVpZ2h0KSlcbn1cblxuZXhwb3J0IHtcbiAgdG9SZ2JhLFxuICB0b0ltYWdlRGF0YSxcbiAgdG9Qbmdcbn1cbiJdfQ==